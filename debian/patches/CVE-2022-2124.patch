From 2f074f4685897ab7212e25931eeeb0212292829f Mon Sep 17 00:00:00 2001
From: Bram Moolenaar <Bram@vim.org>
Date: Sat, 18 Jun 2022 11:22:40 +0100
Subject: [PATCH] patch 8.2.5120: searching for quotes may go over the end of
 the line

Problem:    Searching for quotes may go over the end of the line.
Solution:   Check for running into the NUL.

--- vim-8.1.2269.orig/src/search.c
+++ vim-8.1.2269/src/search.c
@@ -4480,11 +4480,17 @@ current_quote(
 
 	/* Find out if we have a quote in the selection. */
 	while (i <= col_end)
+	{
+	    // check for going over the end of the line, which can happen if
+	    // the line was changed after the Visual area was selected.
+	    if (line[i] == NUL)
+		break;
 	    if (line[i++] == quotechar)
 	    {
 		selected_quote = TRUE;
 		break;
 	    }
+	}
     }
 
     if (!vis_empty && line[col_start] == quotechar)
