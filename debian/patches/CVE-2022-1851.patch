From: Markus Koschany <apo@debian.org>
Date: Sun, 19 Jun 2022 14:46:13 +0200
Subject: CVE-2022-1851

Origin: https://github.com/vim/vim/commit/78d52883e10d71f23ab72a3d8b9733b00da8c9ad
---
 src/ops.c                |  3 +++
 src/testdir/test_CVE.vim | 13 +++++++++++++
 2 files changed, 16 insertions(+)

--- vim-8.1.2269.orig/src/ops.c
+++ vim-8.1.2269/src/ops.c
@@ -2304,6 +2304,9 @@ op_format(
     {
 	curwin->w_cursor = saved_cursor;
 	saved_cursor.lnum = 0;
+
+    // formatting may have made the cursor position invalid
+    check_cursor();
     }
 
     if (oap->is_VIsual)
